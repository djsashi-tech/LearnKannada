<!DOCTYPE html>
<html lang="kn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡≤ï‡≤®‡≥ç‡≤®‡≤° ‡≤ï‡≤≤‡≤ø‡≤Ø‡≥ã‡≤£ (Kannada Kaliyona) - Enhanced</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Kannada:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* Base Styles */
        body {
            font-family: 'Noto Sans Kannada', sans-serif;
            user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;
            touch-action: manipulation;
            background-color: #f7fafc; /* Lighter gray background */
        }
        button { min-height: 48px; min-width: 48px; }

        /* Main Display Area */
        #displayArea {
            font-size: clamp(2.5rem, 12vw, 7rem);
            line-height: 1.3;
            font-weight: bold;
            text-align: center;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: default;
            background-color: #ffffff;
            border-radius: 1rem;
            border: 1px solid #e2e8f0;
            color: #2d3748;
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Message & Recognition Boxes */
        #messageBox, #recognizedText {
            min-height: 55px;
            font-size: 1.2rem; /* Slightly larger font for feedback */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem; /* Increased gap */
            font-weight: 600; /* Bolder feedback */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Button Styles */
        .nav-button {
            background-color: #4299e1; /* Blue 500 */
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, opacity 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .nav-button:hover:not(:disabled) { background-color: #3182ce; } /* Blue 600 */
        .nav-button:active:not(:disabled) { transform: scale(0.97); }
        .nav-button:disabled { background-color: #a0aec0; cursor: not-allowed; opacity: 0.7; } /* Gray 500 */

        .action-button { background-color: #48bb78; } /* Green 500 */
        .action-button:hover:not(:disabled) { background-color: #38a169; } /* Green 600 */
        .record-button { background-color: #f56565; } /* Red 500 */
        .record-button:hover:not(:disabled) { background-color: #e53e3e; } /* Red 600 */
        .record-button.recording { background-color: #ed8936; animation: pulse 1.5s infinite; } /* Orange 500 */

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(237, 137, 54, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(237, 137, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(237, 137, 54, 0); }
        }

        /* Lesson Title & Score */
        #lessonTitle {
            font-size: 1.3rem;
            font-weight: 600;
            color: #5a67d8; /* Indigo 600 */
            margin-bottom: 0.25rem;
            text-align: center;
        }
        #lessonScore {
            font-size: 1rem;
            font-weight: 500;
            color: #718096; /* Gray 600 */
            text-align: center;
            margin-bottom: 0.5rem;
            min-height: 1.5rem;
        }

        /* Progress Bar & Hint Count Container */
        #progressHintContainer {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        /* Progress Bar */
        #progressBarContainer {
            flex-grow: 1;
            background-color: #e2e8f0; /* Gray 300 */
            border-radius: 0.5rem;
            overflow: hidden;
            height: 1rem;
        }
        #progressBar {
            height: 100%;
            width: 0%;
            background-color: #68d391; /* Green 400 */
            border-radius: 0.5rem;
            transition: width 0.5s ease-in-out;
            text-align: center;
            color: white;
            font-size: 0.75rem;
            line-height: 1rem;
        }
        /* Hint Counter Style */
        #hintCounterDisplay {
            font-size: 0.9rem;
            font-weight: 500;
            color: #4a5568; /* Gray 700 */
            background-color: #edf2f7; /* Gray 200 */
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            white-space: nowrap;
        }
         #hintCounterDisplay i {
             margin-right: 0.25rem;
             color: #4299e1; /* Blue 500 */
         }

        /* Validation Styles - Increased Icon Size */
        #recognizedText i {
            font-size: 1.3em; /* Make icons slightly larger */
        }
        .validation-correct { background-color: #c6f6d5; color: #2f855a; border: 1px solid #9ae6b4; }
        .validation-incorrect { background-color: #fed7d7; color: #c53030; border: 1px solid #feb2b2; }
        .validation-listening { background-color: #feebc8; color: #9c4221; border: 1px solid #fbd38d; }
        .validation-default { background-color: #e2e8f0; color: #4a5568; border: 1px solid #cbd5e0; }
        .message-info { background-color: #bee3f8; color: #2b6cb0; border: 1px solid #90cdf4; }
        .message-error { background-color: #fed7d7; color: #c53030; border: 1px solid #feb2b2; }

    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="w-full max-w-3xl mx-auto bg-white p-5 md:p-7 rounded-xl shadow-lg">
        <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-700 mb-3">‡≤ï‡≤®‡≥ç‡≤®‡≤° ‡≤ï‡≤≤‡≤ø‡≤Ø‡≥ã‡≤£</h1>

        <div id="progressHintContainer">
            <div id="progressBarContainer" title="‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤™‡≥ç‡≤∞‡≤ó‡≤§‡≤ø (Your Progress)">
                <div id="progressBar"></div>
            </div>
            <div id="hintCounterDisplay" title="‡≤ï‡≥á‡≤≥‡≤ø‡≤¶ ‡≤∏‡≥Å‡≤≥‡≤ø‡≤µ‡≥Å‡≤ó‡≤≥ ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü (Number of hints used)">
                <i class="fas fa-headphones"></i> <span id="hintCount">0</span>
            </div>
        </div>

        <div id="lessonTitle">‡≤™‡≤æ‡≤†‡≤¶ ‡≤∂‡≥Ä‡≤∞‡≥ç‡≤∑‡≤ø‡≤ï‡≥Ü</div>
        <div id="lessonScore">‡≤™‡≤æ‡≤†‡≤¶ ‡≤∏‡≥ç‡≤ï‡≥ã‡≤∞‡≥ç</div>
        <p class="text-center text-gray-500 mb-4 text-base">‡≤ï‡≥Ü‡≤≥‡≤ó‡≤ø‡≤®‡≤¶‡≤®‡≥ç‡≤®‡≥Å ‡≤ì‡≤¶‡≤ø ‡≤Æ‡≤§‡≥ç‡≤§‡≥Å '‡≤π‡≥á‡≤≥‡≤ø' ‡≤¨‡≤ü‡≤®‡≥ç ‡≤í‡≤§‡≥ç‡≤§‡≤ø‡≤∞‡≤ø</p>

        <div id="displayArea"></div>

        <div class="flex justify-between mt-5 mb-5">
            <button id="prevButton" class="nav-button" title="‡≤π‡≤ø‡≤Ç‡≤¶‡≤ø‡≤®‡≤¶‡≥Å (Previous)">
                <i class="fas fa-arrow-left"></i> ‡≤π‡≤ø‡≤Ç‡≤¶‡≤ø‡≤®‡≤¶‡≥Å
            </button>
            <button id="nextButton" class="nav-button" title="‡≤Æ‡≥Å‡≤Ç‡≤¶‡≤ø‡≤®‡≤¶‡≥Å (Next)">
                ‡≤Æ‡≥Å‡≤Ç‡≤¶‡≤ø‡≤®‡≤¶‡≥Å <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <div class="flex flex-col sm:flex-row justify-center items-center gap-3 mt-4">
            <button id="speakButton" class="nav-button action-button w-full sm:w-auto" title="‡≤ï‡≥á‡≤≥‡≤ø (Listen)">
                <i class="fas fa-volume-up"></i> ‡≤ï‡≥á‡≤≥‡≤ø
            </button>
            <button id="recordButton" class="nav-button record-button w-full sm:w-auto" title="‡≤π‡≥á‡≤≥‡≤ø (Speak)">
                 <i class="fas fa-microphone"></i> ‡≤π‡≥á‡≤≥‡≤ø
            </button>
        </div>

        <div id="messageBox" class="mt-5 message-info">
             <i class="fas fa-info-circle"></i> <span>‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤≤‡≥Å ‡≤∏‡≤ø‡≤¶‡≥ç‡≤ß!</span>
        </div>
         <div id="recognizedText" class="mt-3 validation-default">
             <i class="fas fa-comment-dots"></i> <span>‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤∏‡≤∞‡≤¶‡≤ø (Your turn)</span>
        </div>
    </div>

    <script>
        // --- Configuration & Content ---

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        const lessons = [
             {
                title: "‡≤™‡≤æ‡≤† 1: ‡≤∏‡≤∞‡≤≥ ‡≤™‡≤¶‡≤ó‡≤≥‡≥Å",
                shuffle: true,
                content: [ "‡≤Æ‡≤®‡≥Ü", "‡≤®‡≥Ä‡≤∞‡≥Å", "‡≤ä‡≤ü", "‡≤ï‡≥Ü‡≤≤‡≤∏", "‡≤¨‡≤æ", "‡≤π‡≥ã‡≤ó‡≥Å", "‡≤ì‡≤¶‡≥Å", "‡≤®‡≥ã‡≤°‡≥Å", "‡≤á‡≤¶‡≥Å", "‡≤Ö‡≤¶‡≥Å", "‡≤π‡≤£‡≥ç‡≤£‡≥Å", "‡≤π‡≥Ç‡≤µ‡≥Å", "‡≤Æ‡≤∞", "‡≤ó‡≤ø‡≤°", "‡≤¨‡≥Ä‡≤¶‡≤ø", "‡≤¶‡≤æ‡≤∞", "‡≤¨‡≤ü‡≥ç‡≤ü‡≥Ü", "‡≤ö‡≤π‡≤æ", "‡≤ï‡≤æ‡≤´‡≤ø", "‡≤π‡≤æ‡≤≤‡≥Å", "‡≤Æ‡≥ä‡≤∏‡≤∞‡≥Å", "‡≤Ö‡≤ï‡≥ç‡≤ï‡≤ø", "‡≤¨‡≥á‡≤≥‡≥Ü", "‡≤§‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø", "‡≤ó‡≤æ‡≤≥‡≤ø", "‡≤¨‡≥Ü‡≤≥‡≤ï‡≥Å", "‡≤∏‡≥Ç‡≤∞‡≥ç‡≤Ø", "‡≤ö‡≤Ç‡≤¶‡≥ç‡≤∞", "‡≤¶‡≤ø‡≤®", "‡≤∞‡≤æ‡≤§‡≥ç‡≤∞‡≤ø", "‡≤¨‡≥Ü‡≤≥‡≤ø‡≤ó‡≥ç‡≤ó‡≥Ü", "‡≤∏‡≤Ç‡≤ú‡≥Ü", "‡≤Æ‡≤ß‡≥ç‡≤Ø‡≤æ‡≤π‡≥ç‡≤®", "‡≤π‡≤£", "‡≤Ö‡≤Ç‡≤ó‡≤°‡≤ø", "‡≤¶‡≤æ‡≤∞‡≤ø", "‡≤ä‡≤∞‡≥Å", "‡≤¶‡≥á‡≤∂", "‡≤∂‡≤æ‡≤≤‡≥Ü", "‡≤ï‡≤æ‡≤≤‡≥á‡≤ú‡≥Å", "‡≤Ü‡≤ü", "‡≤™‡≤æ‡≤†", "‡≤π‡≤æ‡≤°‡≥Å", "‡≤Æ‡≤æ‡≤§‡≥Å", "‡≤®‡≤ó‡≥Å", "‡≤Ö‡≤≥‡≥Å", "‡≤®‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ü", "‡≤é‡≤ö‡≥ç‡≤ö‡≤∞", "‡≤∏‡≥ç‡≤µ‡≤≤‡≥ç‡≤™", "‡≤§‡≥Å‡≤Ç‡≤¨‡≤æ", "‡≤¶‡≥ä‡≤°‡≥ç‡≤°", "‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï", "‡≤í‡≤≥‡≥ç‡≤≥‡≥Ü‡≤Ø", "‡≤ï‡≥Ü‡≤ü‡≥ç‡≤ü", "‡≤π‡≥ä‡≤∏", "‡≤π‡≤≥‡≥Ü‡≤Ø", "‡≤∏‡≥Å‡≤≤‡≤≠", "‡≤ï‡≤∑‡≥ç‡≤ü", "‡≤¨‡≥á‡≤ó", "‡≤®‡≤ø‡≤ß‡≤æ‡≤®", "‡≤á‡≤≤‡≥ç‡≤≤‡≤ø", "‡≤Ö‡≤≤‡≥ç‡≤≤‡≤ø", "‡≤π‡≤§‡≥ç‡≤§‡≤ø‡≤∞", "‡≤¶‡≥Ç‡≤∞", "‡≤Æ‡≥á‡≤≤‡≥Ü", "‡≤ï‡≥Ü‡≤≥‡≤ó‡≥Ü", "‡≤í‡≤≥‡≤ó‡≥Ü", "‡≤π‡≥ä‡≤∞‡≤ó‡≥Ü", "‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Ü", "‡≤π‡≤ø‡≤Ç‡≤¶‡≥Ü", "‡≤Ø‡≤æ‡≤∞‡≥Å", "‡≤è‡≤®‡≥Å", "‡≤Ø‡≤æ‡≤µ‡≤æ‡≤ó", "‡≤é‡≤≤‡≥ç‡≤≤‡≤ø", "‡≤π‡≥á‡≤ó‡≥Ü", "‡≤è‡≤ï‡≥Ü", "‡≤®‡≤æ‡≤®‡≥Å", "‡≤®‡≥Ä‡≤®‡≥Å", "‡≤Ö‡≤µ‡≤®‡≥Å", "‡≤Ö‡≤µ‡≤≥‡≥Å", "‡≤Ö‡≤¶‡≥Å", "‡≤®‡≤æ‡≤µ‡≥Å", "‡≤®‡≥Ä‡≤µ‡≥Å", "‡≤Ö‡≤µ‡≤∞‡≥Å", "‡≤á‡≤µ‡≤∞‡≥Å", "‡≤Ö‡≤Æ‡≥ç‡≤Æ", "‡≤Ö‡≤™‡≥ç‡≤™", "‡≤Ö‡≤£‡≥ç‡≤£", "‡≤§‡≤Æ‡≥ç‡≤Æ", "‡≤Ö‡≤ï‡≥ç‡≤ï", "‡≤§‡≤Ç‡≤ó‡≤ø", "‡≤ó‡≥Ü‡≤≥‡≥Ü‡≤Ø", "‡≤ó‡≥Ü‡≤≥‡≤§‡≤ø", "‡≤Æ‡≤ó‡≥Å", "‡≤¶‡≥á‡≤µ‡≤∞‡≥Å", "‡≤™‡≥Å‡≤∏‡≥ç‡≤§‡≤ï", "‡≤™‡≥Ü‡≤®‡≥ç‡≤®‡≥Å", "‡≤¨‡≤£‡≥ç‡≤£", "‡≤∏‡≤∞‡≤ø", "‡≤§‡≤™‡≥ç‡≤™‡≥Å" ]
            },
            {
                title: "‡≤™‡≤æ‡≤† 2: ‡≤é‡≤∞‡≤°‡≥Å ‡≤™‡≤¶‡≤ó‡≤≥ ‡≤µ‡≤æ‡≤ï‡≥ç‡≤Ø‡≤ó‡≤≥‡≥Å",
                shuffle: true,
                content: [ "‡≤á‡≤¶‡≥Å ‡≤Æ‡≤®‡≥Ü.", "‡≤®‡≥Ä‡≤∞‡≥Å ‡≤ï‡≥Å‡≤°‡≤ø.", "‡≤Æ‡≤®‡≥Ü‡≤ó‡≥Ü ‡≤¨‡≤æ.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤¨‡≤Ç‡≤¶‡≤®‡≥Å.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤π‡≥ã‡≤¶‡≤≥‡≥Å.", "‡≤ï‡≥Ü‡≤≤‡≤∏ ‡≤Æ‡≤æ‡≤°‡≥Å.", "‡≤™‡≥Å‡≤∏‡≥ç‡≤§‡≤ï ‡≤ì‡≤¶‡≥Å.", "‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø ‡≤®‡≤ó‡≥Å.", "‡≤¨‡≥á‡≤ó ‡≤¨‡≤æ.", "‡≤®‡≤ø‡≤ß‡≤æ‡≤® ‡≤π‡≥ã‡≤ó‡≥Å.", "‡≤π‡≤£‡≥ç‡≤£‡≥Å ‡≤§‡≤ø‡≤®‡≥ç‡≤®‡≥Å.", "‡≤π‡≥Ç‡≤µ‡≥Å ‡≤®‡≥ã‡≤°‡≥Å.", "‡≤Æ‡≤∞ ‡≤π‡≤§‡≥ç‡≤§‡≥Å.", "‡≤ó‡≤ø‡≤° ‡≤®‡≥Ü‡≤°‡≥Å.", "‡≤¨‡≥Ä‡≤¶‡≤ø ‡≤¶‡≤æ‡≤ü‡≥Å.", "‡≤¶‡≤æ‡≤∞ ‡≤π‡≤ø‡≤°‡≤ø.", "‡≤¨‡≤ü‡≥ç‡≤ü‡≥Ü ‡≤π‡≤æ‡≤ï‡≥Å.", "‡≤ö‡≤π‡≤æ ‡≤ï‡≥Å‡≤°‡≤ø.", "‡≤ï‡≤æ‡≤´‡≤ø ‡≤¨‡≥á‡≤°.", "‡≤π‡≤æ‡≤≤‡≥Å ‡≤ï‡≥ä‡≤°‡≥Å.", "‡≤Æ‡≥ä‡≤∏‡≤∞‡≥Å ‡≤¨‡≥á‡≤ï‡≥Å.", "‡≤Ö‡≤ï‡≥ç‡≤ï‡≤ø ‡≤§‡≥ä‡≤≥‡≤ø.", "‡≤¨‡≥á‡≤≥‡≥Ü ‡≤¨‡≥á‡≤Ø‡≤ø‡≤∏‡≥Å.", "‡≤§‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤ï‡≤§‡≥ç‡≤§‡≤∞‡≤ø‡≤∏‡≥Å.", "‡≤ó‡≤æ‡≤≥‡≤ø ‡≤¨‡≥Ä‡≤∏‡≤ø‡≤§‡≥Å.", "‡≤¨‡≥Ü‡≤≥‡≤ï‡≥Å ‡≤¨‡≤Ç‡≤§‡≥Å.", "‡≤∏‡≥Ç‡≤∞‡≥ç‡≤Ø ‡≤Æ‡≥Ç‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤ö‡≤Ç‡≤¶‡≥ç‡≤∞ ‡≤ï‡≤æ‡≤£‡≤ø‡≤∏‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤¶‡≤ø‡≤® ‡≤ï‡≤≥‡≥Ü‡≤Ø‡≤ø‡≤§‡≥Å.", "‡≤∞‡≤æ‡≤§‡≥ç‡≤∞‡≤ø ‡≤Ü‡≤Ø‡≤ø‡≤§‡≥Å.", "‡≤¨‡≥Ü‡≤≥‡≤ø‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤è‡≤≥‡≥Å.", "‡≤∏‡≤Ç‡≤ú‡≥Ü ‡≤¨‡≤æ.", "‡≤Æ‡≤ß‡≥ç‡≤Ø‡≤æ‡≤π‡≥ç‡≤® ‡≤ä‡≤ü.", "‡≤π‡≤£ ‡≤ï‡≥ä‡≤°‡≥Å.", "‡≤Ö‡≤Ç‡≤ó‡≤°‡≤ø ‡≤§‡≥Ü‡≤∞‡≥Ü‡≤¶‡≤ø‡≤¶‡≥Ü.", "‡≤¶‡≤æ‡≤∞‡≤ø ‡≤§‡≥ã‡≤∞‡≤ø‡≤∏‡≥Å.", "‡≤ä‡≤∞‡≥Å ‡≤§‡≤≤‡≥Å‡≤™‡≤ø‡≤¶‡≥Ü.", "‡≤¶‡≥á‡≤∂ ‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.", "‡≤∂‡≤æ‡≤≤‡≥Ü ‡≤Æ‡≥Å‡≤ó‡≤ø‡≤Ø‡≤ø‡≤§‡≥Å.", "‡≤ï‡≤æ‡≤≤‡≥á‡≤ú‡≥Å ‡≤Ü‡≤∞‡≤Ç‡≤≠.", "‡≤Ü‡≤ü ‡≤Ü‡≤°‡≥Å.", "‡≤™‡≤æ‡≤† ‡≤ï‡≤≤‡≤ø.", "‡≤π‡≤æ‡≤°‡≥Å ‡≤π‡≥á‡≤≥‡≥Å.", "‡≤Æ‡≤æ‡≤§‡≥Å ‡≤ï‡≥á‡≤≥‡≥Å.", "‡≤®‡≤ó‡≥Å ‡≤®‡≤ø‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≥Å.", "‡≤Ö‡≤≥‡≥Å ‡≤®‡≤ø‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≥Å.", "‡≤®‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ü ‡≤Æ‡≤æ‡≤°‡≥Å.", "‡≤é‡≤ö‡≥ç‡≤ö‡≤∞ ‡≤á‡≤∞‡≥Å.", "‡≤∏‡≥ç‡≤µ‡≤≤‡≥ç‡≤™ ‡≤ï‡≥ä‡≤°‡≥Å.", "‡≤§‡≥Å‡≤Ç‡≤¨‡≤æ ‡≤§‡≤ø‡≤®‡≥ç‡≤®‡≥Å.", "‡≤¶‡≥ä‡≤°‡≥ç‡≤° ‡≤Æ‡≤®‡≥Ü.", "‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï ‡≤Æ‡≤ó‡≥Å.", "‡≤í‡≤≥‡≥ç‡≤≥‡≥Ü‡≤Ø ‡≤π‡≥Å‡≤°‡≥Å‡≤ó.", "‡≤ï‡≥Ü‡≤ü‡≥ç‡≤ü ‡≤ï‡≤®‡≤∏‡≥Å.", "‡≤π‡≥ä‡≤∏ ‡≤¨‡≤ü‡≥ç‡≤ü‡≥Ü.", "‡≤π‡≤≥‡≥Ü‡≤Ø ‡≤®‡≥Ü‡≤®‡≤™‡≥Å.", "‡≤∏‡≥Å‡≤≤‡≤≠ ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü.", "‡≤ï‡≤∑‡≥ç‡≤ü ‡≤ï‡≥Ü‡≤≤‡≤∏.", "‡≤¨‡≥á‡≤ó ‡≤¨‡≤æ.", "‡≤®‡≤ø‡≤ß‡≤æ‡≤® ‡≤π‡≥ã‡≤ó‡≥Å.", "‡≤á‡≤≤‡≥ç‡≤≤‡≤ø ‡≤á‡≤°‡≥Å.", "‡≤Ö‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥ã‡≤°‡≥Å.", "‡≤π‡≤§‡≥ç‡≤§‡≤ø‡≤∞ ‡≤¨‡≤æ.", "‡≤¶‡≥Ç‡≤∞ ‡≤π‡≥ã‡≤ó‡≥Å.", "‡≤Æ‡≥á‡≤≤‡≥Ü ‡≤®‡≥ã‡≤°‡≥Å.", "‡≤ï‡≥Ü‡≤≥‡≤ó‡≥Ü ‡≤á‡≤≥‡≤ø‡≤∏‡≥Å.", "‡≤í‡≤≥‡≤ó‡≥Ü ‡≤¨‡≤æ.", "‡≤π‡≥ä‡≤∞‡≤ó‡≥Ü ‡≤π‡≥ã‡≤ó‡≥Å.", "‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Ü ‡≤∏‡≤∞‡≤ø.", "‡≤π‡≤ø‡≤Ç‡≤¶‡≥Ü ‡≤®‡≥ã‡≤°‡≥Å.", "‡≤Ø‡≤æ‡≤∞‡≥Å ‡≤¨‡≤Ç‡≤¶‡≤∞‡≥Å?", "‡≤è‡≤®‡≥Å ‡≤¨‡≥á‡≤ï‡≥Å?", "‡≤Ø‡≤æ‡≤µ‡≤æ‡≤ó ‡≤¨‡≤∞‡≥Å‡≤µ‡≥Ü?", "‡≤é‡≤≤‡≥ç‡≤≤‡≤ø ‡≤π‡≥ã‡≤¶‡≥Ü?", "‡≤π‡≥á‡≤ó‡≥Ü ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶‡≥Ü?", "‡≤è‡≤ï‡≥Ü ‡≤ï‡≥á‡≤≥‡≤ø‡≤¶‡≥Ü?", "‡≤®‡≤æ‡≤®‡≥Å ‡≤¨‡≤Ç‡≤¶‡≥Ü.", "‡≤®‡≥Ä‡≤®‡≥Å ‡≤π‡≥ã‡≤ó‡≥Å.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤®‡≥ã‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤ï‡≥á‡≤≥‡≤ø‡≤¶‡≤≥‡≥Å.", "‡≤Ö‡≤¶‡≥Å ‡≤π‡≤æ‡≤∞‡≤ø‡≤§‡≥Å.", "‡≤®‡≤æ‡≤µ‡≥Å ‡≤ó‡≥Ü‡≤¶‡≥ç‡≤¶‡≥Ü‡≤µ‡≥Å.", "‡≤®‡≥Ä‡≤µ‡≥Å ‡≤∏‡≥ã‡≤§‡≤∞‡≥Å.", "‡≤Ö‡≤µ‡≤∞‡≥Å ‡≤¨‡≤Ç‡≤¶‡≤∞‡≥Å.", "‡≤á‡≤µ‡≤∞‡≥Å ‡≤Ø‡≤æ‡≤∞‡≥Å?", "‡≤Ö‡≤Æ‡≥ç‡≤Æ ‡≤ï‡≤∞‡≥Ü‡≤¶‡≤∞‡≥Å.", "‡≤Ö‡≤™‡≥ç‡≤™ ‡≤π‡≥á‡≤≥‡≤ø‡≤¶‡≤∞‡≥Å.", "‡≤Ö‡≤£‡≥ç‡≤£ ‡≤®‡≥ã‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤§‡≤Æ‡≥ç‡≤Æ ‡≤Ü‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤Ö‡≤ï‡≥ç‡≤ï ‡≤ì‡≤¶‡≤ø‡≤¶‡≤≥‡≥Å.", "‡≤§‡≤Ç‡≤ó‡≤ø ‡≤Æ‡≤≤‡≤ó‡≤ø‡≤¶‡≤≥‡≥Å.", "‡≤ó‡≥Ü‡≤≥‡≥Ü‡≤Ø ‡≤¨‡≤Ç‡≤¶‡≤®‡≥Å.", "‡≤ó‡≥Ü‡≤≥‡≤§‡≤ø ‡≤π‡≥ã‡≤¶‡≤≥‡≥Å.", "‡≤Æ‡≤ó‡≥Å ‡≤Ö‡≤≥‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü.", "‡≤¶‡≥á‡≤µ‡≤∞‡≥Å ‡≤á‡≤¶‡≥ç‡≤¶‡≤æ‡≤®‡≥Ü.", "‡≤™‡≥Å‡≤∏‡≥ç‡≤§‡≤ï ‡≤ï‡≥ä‡≤°‡≥Å.", "‡≤™‡≥Ü‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≤ó‡≥ã.", "‡≤¨‡≤£‡≥ç‡≤£ ‡≤π‡≤ö‡≥ç‡≤ö‡≥Å.", "‡≤∏‡≤∞‡≤ø ‡≤π‡≥á‡≤≥‡≥Å.", "‡≤§‡≤™‡≥ç‡≤™‡≥Å ‡≤Æ‡≤æ‡≤°‡≤¨‡≥á‡≤°." ]
            },
            {
                title: "‡≤™‡≤æ‡≤† 3: ‡≤Æ‡≥Ç‡≤∞‡≥Å ‡≤™‡≤¶‡≤ó‡≤≥ ‡≤µ‡≤æ‡≤ï‡≥ç‡≤Ø‡≤ó‡≤≥‡≥Å",
                shuffle: true,
                content: [ "‡≤®‡≤æ‡≤®‡≥Å ‡≤®‡≥Ä‡≤∞‡≥Å ‡≤ï‡≥Å‡≤°‡≤ø‡≤¶‡≥Ü.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤∂‡≤æ‡≤≤‡≥Ü‡≤ó‡≥Ü ‡≤π‡≥ã‡≤¶‡≤≥‡≥Å.", "‡≤á‡≤¶‡≥Å ‡≤¶‡≥ä‡≤°‡≥ç‡≤° ‡≤Æ‡≤®‡≥Ü.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø ‡≤ì‡≤¶‡≥Å‡≤§‡≥ç‡≤§‡≤æ‡≤®‡≥Ü.", "‡≤®‡≤æ‡≤µ‡≥Å ‡≤®‡≤æ‡≤≥‡≥Ü ‡≤¨‡≤∞‡≥Å‡≤§‡≥ç‡≤§‡≥á‡≤µ‡≥Ü.", "‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤á‡≤≤‡≥ç‡≤≤‡≤ø ‡≤¨‡≤æ.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤ï‡≥Ü‡≤≤‡≤∏ ‡≤Æ‡≤æ‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≤æ‡≤®‡≥Ü.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤π‡≤æ‡≤°‡≥Å ‡≤π‡≥á‡≤≥‡≥Å‡≤§‡≥ç‡≤§‡≤æ‡≤≥‡≥Ü.", "‡≤Æ‡≤ó‡≥Å ‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø ‡≤®‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤¶‡≥Ü.", "‡≤®‡≤æ‡≤µ‡≥Å ‡≤Ü‡≤ü ‡≤Ü‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≥á‡≤µ‡≥Ü.", "‡≤®‡≤æ‡≤®‡≥Å ‡≤π‡≤£‡≥ç‡≤£‡≥Å ‡≤§‡≤ø‡≤Ç‡≤¶‡≥Ü‡≤®‡≥Å.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤π‡≥Ç‡≤µ‡≥Å ‡≤®‡≥ã‡≤°‡≤ø‡≤¶‡≤≥‡≥Å.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤Æ‡≤∞ ‡≤π‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤®‡≤æ‡≤µ‡≥Å ‡≤ó‡≤ø‡≤° ‡≤®‡≥Ü‡≤ü‡≥ç‡≤ü‡≥Ü‡≤µ‡≥Å.", "‡≤®‡≥Ä‡≤®‡≥Å ‡≤¨‡≥Ä‡≤¶‡≤ø ‡≤¶‡≤æ‡≤ü‡≥Å.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤¶‡≤æ‡≤∞ ‡≤π‡≤ø‡≤°‡≤ø‡≤¶‡≤≥‡≥Å.", "‡≤®‡≤æ‡≤®‡≥Å ‡≤¨‡≤ü‡≥ç‡≤ü‡≥Ü ‡≤π‡≤æ‡≤ï‡≤ø‡≤¶‡≥Ü‡≤®‡≥Å.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤ö‡≤π‡≤æ ‡≤ï‡≥Å‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤Ö‡≤µ‡≤≥‡≤ø‡≤ó‡≥Ü ‡≤ï‡≤æ‡≤´‡≤ø ‡≤¨‡≥á‡≤°.", "‡≤Ö‡≤Æ‡≥ç‡≤Æ ‡≤π‡≤æ‡≤≤‡≥Å ‡≤ï‡≥ä‡≤ü‡≥ç‡≤ü‡≤∞‡≥Å.", "‡≤®‡≤®‡≤ó‡≥Ü ‡≤Æ‡≥ä‡≤∏‡≤∞‡≥Å ‡≤¨‡≥á‡≤ï‡≥Å.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤Ö‡≤ï‡≥ç‡≤ï‡≤ø ‡≤§‡≥ä‡≤≥‡≥Ü‡≤¶‡≤≥‡≥Å.", "‡≤Ö‡≤™‡≥ç‡≤™ ‡≤¨‡≥á‡≤≥‡≥Ü ‡≤§‡≤Ç‡≤¶‡≤∞‡≥Å.", "‡≤Ö‡≤Æ‡≥ç‡≤Æ ‡≤§‡≤∞‡≤ï‡≤æ‡≤∞‡≤ø ‡≤π‡≥Ü‡≤ö‡≥ç‡≤ö‡≤ø‡≤¶‡≤∞‡≥Å.", "‡≤§‡≤£‡≥ç‡≤£‡≤®‡≥Ü ‡≤ó‡≤æ‡≤≥‡≤ø ‡≤¨‡≥Ä‡≤∏‡≤ø‡≤§‡≥Å.", "‡≤™‡≥ç‡≤∞‡≤ï‡≤æ‡≤∂‡≤Æ‡≤æ‡≤® ‡≤¨‡≥Ü‡≤≥‡≤ï‡≥Å ‡≤¨‡≤Ç‡≤§‡≥Å.", "‡≤∏‡≥Ç‡≤∞‡≥ç‡≤Ø ‡≤™‡≥Ç‡≤∞‡≥ç‡≤µ‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Æ‡≥Ç‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤ö‡≤Ç‡≤¶‡≥ç‡≤∞ ‡≤Ü‡≤ï‡≤æ‡≤∂‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤ï‡≤æ‡≤£‡≤ø‡≤∏‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤¶‡≤ø‡≤® ‡≤¨‡≥á‡≤ó ‡≤ï‡≤≥‡≥Ü‡≤Ø‡≤ø‡≤§‡≥Å.", "‡≤∞‡≤æ‡≤§‡≥ç‡≤∞‡≤ø ‡≤®‡≤ø‡≤ß‡≤æ‡≤®‡≤µ‡≤æ‡≤ó‡≤ø ‡≤Ü‡≤Ø‡≤ø‡≤§‡≥Å.", "‡≤®‡≤æ‡≤®‡≥Å ‡≤¨‡≥Ü‡≤≥‡≤ø‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤¨‡≥á‡≤ó ‡≤é‡≤¶‡≥ç‡≤¶‡≥Ü.", "‡≤®‡≥Ä‡≤®‡≥Å ‡≤∏‡≤Ç‡≤ú‡≥Ü ‡≤Æ‡≤®‡≥Ü‡≤ó‡≥Ü ‡≤¨‡≤æ.", "‡≤®‡≤æ‡≤µ‡≥Å ‡≤Æ‡≤ß‡≥ç‡≤Ø‡≤æ‡≤π‡≥ç‡≤® ‡≤ä‡≤ü ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶‡≥Ü‡≤µ‡≥Å.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤®‡≤®‡≤ó‡≥Ü ‡≤π‡≤£ ‡≤ï‡≥ä‡≤ü‡≥ç‡≤ü‡≤®‡≥Å.", "‡≤Ö‡≤Ç‡≤ó‡≤°‡≤ø ‡≤à‡≤ó ‡≤§‡≥Ü‡≤∞‡≥Ü‡≤¶‡≤ø‡≤¶‡≥Ü.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤¶‡≤æ‡≤∞‡≤ø ‡≤§‡≥ã‡≤∞‡≤ø‡≤∏‡≤ø‡≤¶‡≤≥‡≥Å.", "‡≤®‡≤æ‡≤®‡≥Å ‡≤ä‡≤∞‡≥Å ‡≤§‡≤≤‡≥Å‡≤™‡≤ø‡≤¶‡≥Ü‡≤®‡≥Å.", "‡≤®‡≤Æ‡≥ç‡≤Æ ‡≤¶‡≥á‡≤∂ ‡≤∏‡≥Å‡≤Ç‡≤¶‡≤∞‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.", "‡≤∂‡≤æ‡≤≤‡≥Ü ‡≤®‡≤æ‡≤≥‡≥Ü ‡≤∞‡≤ú‡≥Ü.", "‡≤ï‡≤æ‡≤≤‡≥á‡≤ú‡≥Å ‡≤∏‡≥ã‡≤Æ‡≤µ‡≤æ‡≤∞ ‡≤Ü‡≤∞‡≤Ç‡≤≠.", "‡≤Æ‡≤ï‡≥ç‡≤ï‡≤≥‡≥Å ‡≤Ü‡≤ü ‡≤Ü‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≤æ‡≤∞‡≥Ü.", "‡≤µ‡≤ø‡≤¶‡≥ç‡≤Ø‡≤æ‡≤∞‡≥ç‡≤•‡≤ø‡≤ó‡≤≥‡≥Å ‡≤™‡≤æ‡≤† ‡≤ï‡≤≤‡≤ø‡≤Ø‡≥Å‡≤§‡≥ç‡≤§‡≤æ‡≤∞‡≥Ü.", "‡≤ó‡≤æ‡≤Ø‡≤ï‡≤ø ‡≤π‡≤æ‡≤°‡≥Å ‡≤π‡≥á‡≤≥‡≥Å‡≤§‡≥ç‡≤§‡≤æ‡≤≥‡≥Ü.", "‡≤π‡≤ø‡≤∞‡≤ø‡≤Ø‡≤∞‡≥Å ‡≤Æ‡≤æ‡≤§‡≥Å ‡≤π‡≥á‡≤≥‡≥Å‡≤§‡≥ç‡≤§‡≤æ‡≤∞‡≥Ü.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤ú‡≥ã‡≤∞‡≤æ‡≤ó‡≤ø ‡≤®‡≤ï‡≥ç‡≤ï‡≤≥‡≥Å.", "‡≤Æ‡≤ó‡≥Å ‡≤§‡≥Å‡≤Ç‡≤¨‡≤æ ‡≤Ö‡≤≥‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤ó‡≤æ‡≤¢ ‡≤®‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ü ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤®‡≤æ‡≤®‡≥Å ‡≤à‡≤ó ‡≤é‡≤ö‡≥ç‡≤ö‡≤∞‡≤µ‡≤æ‡≤¶‡≥Ü.", "‡≤®‡≤®‡≤ó‡≥Ü ‡≤∏‡≥ç‡≤µ‡≤≤‡≥ç‡≤™ ‡≤®‡≥Ä‡≤∞‡≥Å ‡≤ï‡≥ä‡≤°‡≥Å.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤§‡≥Å‡≤Ç‡≤¨‡≤æ ‡≤ä‡≤ü ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤á‡≤¶‡≥Å ‡≤§‡≥Å‡≤Ç‡≤¨‡≤æ ‡≤¶‡≥ä‡≤°‡≥ç‡≤° ‡≤Æ‡≤®‡≥Ü.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï ‡≤Æ‡≤ó‡≥Å ‡≤Ö‡≤≤‡≥ç‡≤≤.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤í‡≤≥‡≥ç‡≤≥‡≥Ü‡≤Ø ‡≤π‡≥Å‡≤°‡≥Å‡≤ó ‡≤π‡≥å‡≤¶‡≥Å.", "‡≤®‡≤æ‡≤®‡≥Å ‡≤ï‡≥Ü‡≤ü‡≥ç‡≤ü ‡≤ï‡≤®‡≤∏‡≥Å ‡≤ï‡≤Ç‡≤°‡≥Ü.", "‡≤á‡≤µ‡≥Å ‡≤π‡≥ä‡≤∏ ‡≤¨‡≤ü‡≥ç‡≤ü‡≥Ü‡≤ó‡≤≥‡≥Å.", "‡≤Ö‡≤¶‡≥Å ‡≤π‡≤≥‡≥Ü‡≤Ø ‡≤®‡≥Ü‡≤®‡≤™‡≥Å ‡≤Æ‡≤æ‡≤§‡≥ç‡≤∞.", "‡≤à ‡≤™‡≥ç‡≤∞‡≤∂‡≥ç‡≤®‡≥Ü ‡≤∏‡≥Å‡≤≤‡≤≠‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.", "‡≤Ü ‡≤ï‡≥Ü‡≤≤‡≤∏ ‡≤ï‡≤∑‡≥ç‡≤ü‡≤ï‡≤∞‡≤µ‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü.", "‡≤®‡≥Ä‡≤®‡≥Å ‡≤¨‡≥á‡≤ó ‡≤¨‡≤∞‡≤¨‡≥á‡≤ï‡≥Å.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤®‡≤ø‡≤ß‡≤æ‡≤®‡≤µ‡≤æ‡≤ó‡≤ø ‡≤π‡≥ã‡≤¶‡≤®‡≥Å.", "‡≤™‡≥Å‡≤∏‡≥ç‡≤§‡≤ï‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤á‡≤≤‡≥ç‡≤≤‡≤ø ‡≤á‡≤°‡≥Å.", "‡≤Ü ‡≤ö‡≤ø‡≤§‡≥ç‡≤∞‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤Ö‡≤≤‡≥ç‡≤≤‡≤ø ‡≤®‡≥ã‡≤°‡≥Å.", "‡≤®‡≤®‡≥ç‡≤® ‡≤π‡≤§‡≥ç‡≤§‡≤ø‡≤∞ ‡≤¨‡≤æ.", "‡≤Ö‡≤µ‡≤®‡≤ø‡≤Ç‡≤¶ ‡≤¶‡≥Ç‡≤∞ ‡≤π‡≥ã‡≤ó‡≥Å.", "‡≤Ü‡≤ï‡≤æ‡≤∂‡≤¶ ‡≤Æ‡≥á‡≤≤‡≥Ü ‡≤®‡≥ã‡≤°‡≥Å.", "‡≤Æ‡≤∞‡≤¶‡≤ø‡≤Ç‡≤¶ ‡≤ï‡≥Ü‡≤≥‡≤ó‡≥Ü ‡≤á‡≤≥‡≤ø‡≤∏‡≥Å.", "‡≤Æ‡≤®‡≥Ü‡≤Ø ‡≤í‡≤≥‡≤ó‡≥Ü ‡≤¨‡≤æ.", "‡≤∂‡≤æ‡≤≤‡≥Ü‡≤Ø ‡≤π‡≥ä‡≤∞‡≤ó‡≥Ü ‡≤π‡≥ã‡≤ó‡≥Å.", "‡≤∏‡≤æ‡≤≤‡≤ø‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Æ‡≥Å‡≤Ç‡≤¶‡≥Ü ‡≤∏‡≤∞‡≤ø.", "‡≤ï‡≤®‡≥ç‡≤®‡≤°‡≤ø‡≤Ø ‡≤π‡≤ø‡≤Ç‡≤¶‡≥Ü ‡≤®‡≥ã‡≤°‡≥Å.", "‡≤®‡≤ø‡≤®‡≥ç‡≤®‡≥Ü ‡≤Ø‡≤æ‡≤∞‡≥Å ‡≤¨‡≤Ç‡≤¶‡≤∞‡≥Å?", "‡≤®‡≤ø‡≤®‡≤ó‡≥Ü ‡≤è‡≤®‡≥Å ‡≤¨‡≥á‡≤ï‡≥Å?", "‡≤®‡≥Ä‡≤®‡≥Å ‡≤Ø‡≤æ‡≤µ‡≤æ‡≤ó ‡≤¨‡≤∞‡≥Å‡≤µ‡≥Ü?", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤é‡≤≤‡≥ç‡≤≤‡≤ø‡≤ó‡≥Ü ‡≤π‡≥ã‡≤¶‡≤®‡≥Å?", "‡≤á‡≤¶‡≤®‡≥ç‡≤®‡≥Å ‡≤π‡≥á‡≤ó‡≥Ü ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶‡≥Ü?", "‡≤®‡≥Ä‡≤®‡≥Å ‡≤è‡≤ï‡≥Ü ‡≤ï‡≥á‡≤≥‡≤ø‡≤¶‡≥Ü?", "‡≤®‡≤æ‡≤®‡≥Å ‡≤®‡≤ø‡≤®‡≥ç‡≤®‡≥Ü ‡≤¨‡≤Ç‡≤¶‡≥Ü.", "‡≤®‡≥Ä‡≤®‡≥Å ‡≤®‡≤æ‡≤≥‡≥Ü ‡≤π‡≥ã‡≤ó‡≥Å.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤∏‡≤ø‡≤®‡≤ø‡≤Æ‡≤æ ‡≤®‡≥ã‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤π‡≤æ‡≤°‡≥Å ‡≤ï‡≥á‡≤≥‡≤ø‡≤¶‡≤≥‡≥Å.", "‡≤Ü ‡≤π‡≤ï‡≥ç‡≤ï‡≤ø ‡≤π‡≤æ‡≤∞‡≤ø‡≤§‡≥Å.", "‡≤®‡≤æ‡≤µ‡≥Å ‡≤™‡≤Ç‡≤¶‡≥ç‡≤Ø ‡≤ó‡≥Ü‡≤¶‡≥ç‡≤¶‡≥Ü‡≤µ‡≥Å.", "‡≤®‡≥Ä‡≤µ‡≥Å ‡≤è‡≤ï‡≥Ü ‡≤∏‡≥ã‡≤§‡≤∞‡≥Å?", "‡≤Ö‡≤µ‡≤∞‡≥Å ‡≤®‡≤æ‡≤ü‡≤ï ‡≤®‡≥ã‡≤°‡≤ø‡≤¶‡≤∞‡≥Å.", "‡≤á‡≤µ‡≤∞‡≥Å ‡≤®‡≤®‡≥ç‡≤® ‡≤∏‡≥ç‡≤®‡≥á‡≤π‡≤ø‡≤§‡≤∞‡≥Å.", "‡≤Ö‡≤Æ‡≥ç‡≤Æ ‡≤Ö‡≤°‡≥Å‡≤ó‡≥Ü ‡≤Æ‡≤æ‡≤°‡≤ø‡≤¶‡≤∞‡≥Å.", "‡≤Ö‡≤™‡≥ç‡≤™ ‡≤™‡≥á‡≤™‡≤∞‡≥ç ‡≤ì‡≤¶‡≤ø‡≤¶‡≤∞‡≥Å.", "‡≤Ö‡≤£‡≥ç‡≤£ ‡≤ï‡≥ç‡≤∞‡≤ø‡≤ï‡≥Ü‡≤ü‡≥ç ‡≤Ü‡≤°‡≤ø‡≤¶‡≤®‡≥Å.", "‡≤§‡≤Æ‡≥ç‡≤Æ ‡≤∂‡≤æ‡≤≤‡≥Ü‡≤ó‡≥Ü ‡≤π‡≥ã‡≤¶‡≤®‡≥Å.", "‡≤Ö‡≤ï‡≥ç‡≤ï ‡≤ö‡≤ø‡≤§‡≥ç‡≤∞ ‡≤¨‡≤∞‡≥Ü‡≤¶‡≤≥‡≥Å.", "‡≤§‡≤Ç‡≤ó‡≤ø ‡≤ó‡≥ä‡≤Ç‡≤¨‡≥Ü ‡≤Ü‡≤°‡≤ø‡≤¶‡≤≥‡≥Å.", "‡≤®‡≤®‡≥ç‡≤® ‡≤ó‡≥Ü‡≤≥‡≥Ü‡≤Ø ‡≤¨‡≤Ç‡≤¶‡≤®‡≥Å.", "‡≤Ö‡≤µ‡≤≥ ‡≤ó‡≥Ü‡≤≥‡≤§‡≤ø ‡≤π‡≥ã‡≤¶‡≤≥‡≥Å.", "‡≤Ü ‡≤Æ‡≤ó‡≥Å ‡≤Ö‡≤≥‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü.", "‡≤¶‡≥á‡≤µ‡≤∞‡≥Å ‡≤é‡≤≤‡≥ç‡≤≤‡≥Ü‡≤°‡≥Ü ‡≤á‡≤¶‡≥ç‡≤¶‡≤æ‡≤®‡≥Ü.", "‡≤®‡≤æ‡≤®‡≥Å ‡≤™‡≥Å‡≤∏‡≥ç‡≤§‡≤ï ‡≤ì‡≤¶‡≤ø‡≤¶‡≥Ü‡≤®‡≥Å.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤™‡≥Ü‡≤®‡≥ç‡≤®‡≥Å ‡≤§‡≤Ç‡≤¶‡≤®‡≥Å.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤¨‡≤£‡≥ç‡≤£ ‡≤π‡≤ö‡≥ç‡≤ö‡≤ø‡≤¶‡≤≥‡≥Å.", "‡≤®‡≥Ä‡≤®‡≥Å ‡≤∏‡≤∞‡≤ø ‡≤π‡≥á‡≤≥‡≤ø‡≤¶‡≥Ü.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤§‡≤™‡≥ç‡≤™‡≥Å ‡≤Æ‡≤æ‡≤°‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤." ]
            },
            {
                title: "‡≤™‡≤æ‡≤† 4: ‡≤¶‡≥ä‡≤°‡≥ç‡≤° ‡≤µ‡≤æ‡≤ï‡≥ç‡≤Ø‡≤ó‡≤≥‡≥Å",
                shuffle: false,
                content: [ "‡≤®‡≤æ‡≤®‡≥Å ‡≤®‡≤æ‡≤≥‡≥Ü ‡≤¨‡≥Ü‡≤Ç‡≤ó‡≤≥‡≥Ç‡≤∞‡≤ø‡≤ó‡≥Ü ‡≤π‡≥ã‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≥á‡≤®‡≥Ü.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤®‡≤ø‡≤®‡≥ç‡≤®‡≥Ü ‡≤Ö‡≤Ç‡≤ó‡≤°‡≤ø‡≤Ø‡≤ø‡≤Ç‡≤¶ ‡≤π‡≤£‡≥ç‡≤£‡≥Å ‡≤§‡≤Ç‡≤¶‡≤≥‡≥Å.", "‡≤à ‡≤™‡≥Å‡≤∏‡≥ç‡≤§‡≤ï‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤®‡≤®‡≤ó‡≥Ü ‡≤ï‡≥ä‡≤°‡≤ø.", "‡≤®‡≤æ‡≤µ‡≥Å ‡≤á‡≤Ç‡≤¶‡≥Å ‡≤∏‡≤Ç‡≤ú‡≥Ü ‡≤∏‡≤ø‡≤®‡≤ø‡≤Æ‡≤æ ‡≤®‡≥ã‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≥á‡≤µ‡≥Ü.", "‡≤Æ‡≤ï‡≥ç‡≤ï‡≤≥‡≥Å ‡≤Ü‡≤ü‡≤¶ ‡≤Æ‡≥à‡≤¶‡≤æ‡≤®‡≤¶‡≤≤‡≥ç‡≤≤‡≤ø ‡≤Ü‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥ç‡≤¶‡≤æ‡≤∞‡≥Ü.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤™‡≥ç‡≤∞‡≤§‡≤ø‡≤¶‡≤ø‡≤® ‡≤¨‡≥Ü‡≤≥‡≤ø‡≤ó‡≥ç‡≤ó‡≥Ü ‡≤¨‡≥á‡≤ó ‡≤è‡≤≥‡≥Å‡≤§‡≥ç‡≤§‡≤æ‡≤®‡≥Ü.", "‡≤Ö‡≤µ‡≤≥‡≥Å ‡≤ï‡≤®‡≥ç‡≤®‡≤°‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø ‡≤Æ‡≤æ‡≤§‡≤®‡≤æ‡≤°‡≥Å‡≤§‡≥ç‡≤§‡≤æ‡≤≥‡≥Ü.", "‡≤®‡≤æ‡≤µ‡≥Å ‡≤Æ‡≥Å‡≤Ç‡≤¶‡≤ø‡≤® ‡≤µ‡≤æ‡≤∞ ‡≤™‡≥ç‡≤∞‡≤µ‡≤æ‡≤∏ ‡≤π‡≥ã‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≥á‡≤µ‡≥Ü.", "‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤¨‡≤æ‡≤ó‡≤ø‡≤≤‡≤®‡≥ç‡≤®‡≥Å ‡≤Æ‡≥Å‡≤ö‡≥ç‡≤ö‡≤ø ‡≤í‡≤≥‡≤ó‡≥Ü ‡≤¨‡≤®‡≥ç‡≤®‡≤ø.", "‡≤à ‡≤ä‡≤ü ‡≤§‡≥Å‡≤Ç‡≤¨‡≤æ ‡≤∞‡≥Å‡≤ö‡≤ø‡≤ï‡≤∞‡≤µ‡≤æ‡≤ó‡≤ø ‡≤á‡≤¶‡≥Ü.", "‡≤Æ‡≤≥‡≥Ü ‡≤¨‡≤Ç‡≤¶ ‡≤ï‡≤æ‡≤∞‡≤£ ‡≤®‡≤æ‡≤µ‡≥Å ‡≤Æ‡≤®‡≥Ü‡≤Ø‡≤≤‡≥ç‡≤≤‡≥á ‡≤â‡≤≥‡≤ø‡≤¶‡≥Ü‡≤µ‡≥Å.", "‡≤Ö‡≤µ‡≤®‡≥Å ‡≤§‡≤®‡≥ç‡≤® ‡≤∏‡≥ç‡≤®‡≥á‡≤π‡≤ø‡≤§‡≤® ‡≤ú‡≥ä‡≤§‡≥Ü ‡≤Ü‡≤∏‡≥ç‡≤™‡≤§‡≥ç‡≤∞‡≥Ü‡≤ó‡≥Ü ‡≤π‡≥ã‡≤¶‡≤®‡≥Å.", "‡≤®‡≤æ‡≤µ‡≥Å ‡≤¨‡≤∏‡≥ç‡≤∏‡≤ø‡≤®‡≤≤‡≥ç‡≤≤‡≤ø ‡≤™‡≥ç‡≤∞‡≤Ø‡≤æ‡≤£ ‡≤Æ‡≤æ‡≤°‡≤ø ‡≤¶‡≥á‡≤µ‡≤∏‡≥ç‡≤•‡≤æ‡≤® ‡≤§‡≤≤‡≥Å‡≤™‡≤ø‡≤¶‡≥Ü‡≤µ‡≥Å.", "‡≤à ‡≤ï‡≤•‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤æ‡≤®‡≥Å ‡≤ö‡≤ø‡≤ï‡≥ç‡≤ï‡≤µ‡≤®‡≤ø‡≤¶‡≥ç‡≤¶‡≤æ‡≤ó ‡≤ï‡≥á‡≤≥‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ü.", "‡≤™‡≤∞‡≥Ä‡≤ï‡≥ç‡≤∑‡≥Ü‡≤Ø‡≤≤‡≥ç‡≤≤‡≤ø ‡≤í‡≤≥‡≥ç‡≤≥‡≥Ü‡≤Ø ‡≤Ö‡≤Ç‡≤ï‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≤°‡≥Ü‡≤Ø‡≤≤‡≥Å ‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø ‡≤ì‡≤¶‡≤¨‡≥á‡≤ï‡≥Å." ]
            }
        ];

        // --- Global State Variables ---
        let currentContentIndex = 0;
        let courseContent = [];
        let synth = window.speechSynthesis;
        let recognition;
        let isRecording = false;
        let isCurrentItemCorrect = false;
        let micPermissionState = 'prompt';
        let hintCounter = 0;
        let lessonScores = {};
        let currentItemHintUsed = false;

        // --- DOM Element References ---
        const displayArea = document.getElementById('displayArea');
        const lessonTitleElement = document.getElementById('lessonTitle');
        const lessonScoreElement = document.getElementById('lessonScore');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const speakButton = document.getElementById('speakButton');
        const recordButton = document.getElementById('recordButton');
        const messageBox = document.getElementById('messageBox');
        const messageBoxIcon = messageBox.querySelector('i');
        const messageBoxText = messageBox.querySelector('span');
        const recognizedTextElement = document.getElementById('recognizedText');
        const recognizedTextIcon = recognizedTextElement.querySelector('i');
        const recognizedTextSpan = recognizedTextElement.querySelector('span');
        const progressBar = document.getElementById('progressBar');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const hintCountSpan = document.getElementById('hintCount');


        // --- Core Application Functions ---

        function prepareCourseContent() {
            courseContent = [];
            lessonScores = {};
            lessons.forEach((lesson) => {
                let contentToAdd = lesson.content;
                if (lesson.shuffle) {
                    contentToAdd = shuffleArray([...lesson.content]);
                }
                lessonScores[lesson.title] = { correct: 0, total: contentToAdd.length, hints: 0 };
                contentToAdd.forEach((item, itemIndex) => {
                    courseContent.push({ text: item, lessonTitle: lesson.title, isFirstItemOfLesson: itemIndex === 0 });
                });
            });
            console.log(`Prepared ${courseContent.length} items. Score tracking initialized.`);
            console.log("Initial Scores:", lessonScores);
        }

        function updateDisplay() {
            if (courseContent.length === 0) return;
            const currentItem = courseContent[currentContentIndex];
            displayArea.textContent = currentItem.text;
            lessonTitleElement.textContent = currentItem.lessonTitle;
            isCurrentItemCorrect = false;
            currentItemHintUsed = false;
            resetValidationUI(); // Reset to default "Your turn" state
            updateLessonScoreDisplay();
            updateNavButtons();
            updateProgressBar();
            if (currentItem.isFirstItemOfLesson && currentContentIndex > 0) {
                 showMessage(`‡≤π‡≥ä‡≤∏ ‡≤™‡≤æ‡≤† ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠: ${currentItem.lessonTitle}`, 'info');
            } else if (currentContentIndex === 0 && currentItem.isFirstItemOfLesson) {
                 showMessage(`‡≤™‡≤æ‡≤† ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠: ${currentItem.lessonTitle}`, 'info');
            }
        }

        function updateLessonScoreDisplay() {
            if (courseContent.length === 0) return;
            const currentLessonTitle = courseContent[currentContentIndex].lessonTitle;
            const score = lessonScores[currentLessonTitle];
            if (score) {
                lessonScoreElement.textContent = `‡≤™‡≤æ‡≤†‡≤¶ ‡≤∏‡≥ç‡≤ï‡≥ã‡≤∞‡≥ç: ${score.correct} / ${score.total}`;
            } else {
                lessonScoreElement.textContent = "";
            }
        }

        function updateProgressBar() {
            const totalItems = courseContent.length;
            const completedItems = currentContentIndex + 1;
            const progress = totalItems > 0 ? (completedItems / totalItems) * 100 : 0;
            progressBar.style.width = `${progress}%`;
            progressBarContainer.title = `‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤™‡≥ç‡≤∞‡≤ó‡≤§‡≤ø: ${completedItems} / ${totalItems}`;
        }

        function updateNavButtons() {
            prevButton.disabled = currentContentIndex === 0;
            nextButton.disabled = (currentContentIndex === courseContent.length - 1) || !isCurrentItemCorrect;
        }

        function speakText(text) {
            if (synth.speaking) { synth.cancel(); setTimeout(() => speakText(text), 100); return; }
            if (text === '') return;
            let voices = synth.getVoices();
            let kannadaVoice = voices.find(voice => voice.lang === 'kn-IN') || voices.find(voice => voice.lang.startsWith('kn')) || voices.find(voice => voice.lang === 'hi-IN') || voices.find(voice => voice.default);
            if (!kannadaVoice) { showMessage("‡≤Ø‡≤æ‡≤µ‡≥Å‡≤¶‡≥á ‡≤∏‡≥Ç‡≤ï‡≥ç‡≤§ ‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤.", 'error'); return; }
            const utterThis = new SpeechSynthesisUtterance(text);
            utterThis.voice = kannadaVoice;
            utterThis.lang = kannadaVoice.lang;
            utterThis.pitch = 1;
            utterThis.rate = 0.85;
            utterThis.onstart = () => { speakButton.disabled = true; };
            utterThis.onend = () => { speakButton.disabled = false; };
            utterThis.onerror = (event) => {
                console.error('SpeechSynthesis Error:', event.error, 'Utterance:', text, 'Voice:', kannadaVoice?.name);
                showMessage(`‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤¶‡≥ã‡≤∑: ${event.error}. ‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤™‡≥Å‡≤ü‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤∞‡≤ø‡≤´‡≥ç‡≤∞‡≥Ü‡≤∂‡≥ç ‡≤Æ‡≤æ‡≤°‡≤≤‡≥Å ‡≤™‡≥ç‡≤∞‡≤Ø‡≤§‡≥ç‡≤®‡≤ø‡≤∏‡≤ø.`, 'error');
                speakButton.disabled = false;
            };
            synth.speak(utterThis);
        }

        function showMessage(message, type = 'info') {
            messageBoxText.textContent = message;
            messageBox.className = `mt-5 ${type === 'error' ? 'message-error' : 'message-info'}`;
            messageBoxIcon.className = `fas ${type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}`;
        }

        // Update the validation feedback area with simplified messages
        function updateValidationUI(status, message = "") { // Message is now optional for some statuses
            let iconClass = 'fas fa-comment-dots';
            let textContent = message || '‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤∏‡≤∞‡≤¶‡≤ø'; // Default text
            let elementClass = 'mt-3 validation-default';

            switch (status) {
                case 'correct':
                    elementClass = 'mt-3 validation-correct';
                    iconClass = 'fas fa-check-circle';
                    textContent = "‡≤∏‡≤∞‡≤ø!"; // Simplified text
                    break;
                case 'incorrect':
                    elementClass = 'mt-3 validation-incorrect';
                    iconClass = 'fas fa-times-circle';
                    textContent = "‡≤§‡≤™‡≥ç‡≤™‡≥Å! ‡≤Æ‡≤§‡≥ç‡≤§‡≥Ü ‡≤™‡≥ç‡≤∞‡≤Ø‡≤§‡≥ç‡≤®‡≤ø‡≤∏‡≤ø"; // Simplified text
                    break;
                case 'listening':
                    elementClass = 'mt-3 validation-listening';
                    iconClass = 'fas fa-microphone-alt animate-pulse';
                    textContent = "‡≤ï‡≥á‡≤≥‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü..."; // Clear listening text
                    break;
                case 'processing':
                     elementClass = 'mt-3 validation-listening'; // Use listening style
                     iconClass = 'fas fa-spinner fa-spin';
                     textContent = "‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü..."; // Processing text
                     break;
                // Default state remains '‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤∏‡≤∞‡≤¶‡≤ø'
            }
            recognizedTextElement.className = elementClass;
            recognizedTextIcon.className = iconClass;
            recognizedTextSpan.textContent = textContent;
        }

        function resetValidationUI() {
             // Reset to the initial default state
             updateValidationUI('default', '‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤∏‡≤∞‡≤¶‡≤ø');
        }

         // Initialize the Speech Recognition engine
        function initializeSpeechRecognition() {
            window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!window.SpeechRecognition) {
                showMessage("‡≤ï‡≥ç‡≤∑‡≤Æ‡≤ø‡≤∏‡≤ø, ‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤ó‡≥Å‡≤∞‡≥Å‡≤§‡≤ø‡≤∏‡≥Å‡≤µ‡≤ø‡≤ï‡≥Ü ‡≤¨‡≥Ü‡≤Ç‡≤¨‡≤≤‡≤ø‡≤∏‡≥Å‡≤µ‡≥Å‡≤¶‡≤ø‡≤≤‡≥ç‡≤≤.", 'error');
                recordButton.disabled = true;
                return false;
            }
            recognition = new SpeechRecognition();
            recognition.lang = 'kn-IN';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                isRecording = true;
                recordButton.classList.add('recording');
                recordButton.innerHTML = `<i class="fas fa-stop-circle"></i> ‡≤®‡≤ø‡≤≤‡≥ç‡≤≤‡≤ø‡≤∏‡≤ø`;
                updateValidationUI('listening'); // Show listening UI
            };

            recognition.onresult = (event) => {
                updateValidationUI('processing'); // Show processing UI
                const speechResult = event.results[0][0].transcript.trim();
                const confidence = event.results[0][0].confidence;
                console.log(`Recognition: "${speechResult}" (Confidence: ${confidence.toFixed(2)})`); // Log for debugging

                const currentTargetText = courseContent[currentContentIndex].text;
                const currentLessonTitle = courseContent[currentContentIndex].lessonTitle;
                const normalize = (str) => str.replace(/[.,!?]/g, '').replace(/\s+/g, ' ').trim().toLowerCase();

                setTimeout(() => {
                    if (normalize(speechResult) === normalize(currentTargetText)) {
                        // --- CORRECT ---
                        if (!isCurrentItemCorrect) {
                             lessonScores[currentLessonTitle].correct++;
                             updateLessonScoreDisplay();
                             console.log("Updated Scores:", lessonScores);
                        }
                        isCurrentItemCorrect = true;
                        updateValidationUI('correct'); // Show simplified correct UI
                        updateNavButtons();
                        showMessage("‡≤§‡≥Å‡≤Ç‡≤¨‡≤æ ‡≤ö‡≥Ü‡≤®‡≥ç‡≤®‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü! '‡≤Æ‡≥Å‡≤Ç‡≤¶‡≤ø‡≤®‡≤¶‡≥Å' ‡≤í‡≤§‡≥ç‡≤§‡≤ø‡≤∞‡≤ø.", 'info');
                    } else {
                        // --- INCORRECT ---
                        isCurrentItemCorrect = false;
                        updateValidationUI('incorrect'); // Show simplified incorrect UI
                        // Provide guidance in the main message box instead
                        showMessage(`‡≤ï‡≥á‡≤≥‡≤ø‡≤∏‡≤ø‡≤¶‡≥ç‡≤¶‡≥Å: "${speechResult}". ‡≤∏‡≤∞‡≤ø‡≤Ø‡≤æ‡≤¶‡≤¶‡≥ç‡≤¶‡≥Å: "${currentTargetText}".`, 'error');
                    }
                     if(isRecording) stopRecordingVisuals();
                }, 300);
            };

            recognition.onspeechend = () => {
                 if (isRecording) {
                     updateValidationUI('processing'); // Show processing UI
                 }
            };
            recognition.onnomatch = () => {
                 updateValidationUI('incorrect', "‡≤∏‡≥ç‡≤™‡≤∑‡≥ç‡≤ü‡≤µ‡≤æ‡≤ó‡≤ø ‡≤ï‡≥á‡≤≥‡≤ø‡≤∏‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤"); // Simplified message
                 showMessage("‡≤ï‡≥ç‡≤∑‡≤Æ‡≤ø‡≤∏‡≤ø, ‡≤®‡≤®‡≤ó‡≥Ü ‡≤Ö‡≤∞‡≥ç‡≤•‡≤µ‡≤æ‡≤ó‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤. ‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤Æ‡≤§‡≥ç‡≤§‡≥Ü ‡≤™‡≥ç‡≤∞‡≤Ø‡≤§‡≥ç‡≤®‡≤ø‡≤∏‡≤ø.", 'error');
                 stopRecording();
            };
            recognition.onerror = (event) => {
                console.error('SpeechRecognition error:', event.error);
                let errorMsg = "‡≤ß‡≥ç‡≤µ‡≤®‡≤ø ‡≤¶‡≥ã‡≤∑: ";
                 switch (event.error) {
                    case 'no-speech': errorMsg += "‡≤Æ‡≤æ‡≤§‡≥Å ‡≤ï‡≥á‡≤≥‡≤ø‡≤∏‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤."; break;
                    case 'audio-capture': errorMsg += "‡≤Æ‡≥à‡≤ï‡≥ç‡≤∞‡≥ä‡≤´‡≥ã‡≤®‡≥ç ‡≤∏‡≤Æ‡≤∏‡≥ç‡≤Ø‡≥Ü."; micPermissionState = 'prompt'; break;
                    case 'not-allowed': errorMsg += "‡≤Æ‡≥à‡≤ï‡≥ç‡≤∞‡≥ä‡≤´‡≥ã‡≤®‡≥ç ‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø ‡≤¨‡≥á‡≤ï‡≥Å."; micPermissionState = 'denied'; break;
                    default: errorMsg += event.error;
                }
                resetValidationUI(); // Reset to default on error
                showMessage(errorMsg, 'error');
                stopRecording(); // Ensure recording stops fully on error
            };
            recognition.onend = () => {
                 stopRecording(); // Ensure clean stop
            };
            return true;
        }

        function startRecognitionEngine() {
            if (!recognition || isRecording) return;
            try {
                recognition.start();
            } catch (e) {
                console.error("Error starting recognition engine:", e);
                showMessage("‡≤∞‡≥Ü‡≤ï‡≤æ‡≤∞‡≥ç‡≤°‡≤ø‡≤Ç‡≤ó‡≥ç ‡≤™‡≥ç‡≤∞‡≤æ‡≤∞‡≤Ç‡≤≠‡≤ø‡≤∏‡≤≤‡≥Å ‡≤∏‡≤æ‡≤ß‡≥ç‡≤Ø‡≤µ‡≤æ‡≤ó‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤.", 'error');
                stopRecordingVisuals();
            }
        }

        function requestMicPermissionAndStart() {
             navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                     stream.getTracks().forEach(track => track.stop());
                     micPermissionState = 'granted';
                     console.log("Microphone permission granted via getUserMedia.");
                     startRecognitionEngine();
                })
                .catch(err => {
                    console.error("getUserMedia error:", err);
                    micPermissionState = 'denied';
                    if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                        showMessage("‡≤Æ‡≥à‡≤ï‡≥ç‡≤∞‡≥ä‡≤´‡≥ã‡≤®‡≥ç ‡≤¨‡≤≥‡≤∏‡≤≤‡≥Å ‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø ‡≤¨‡≥á‡≤ï‡≥Å.", 'error');
                        updateValidationUI('default', '‡≤Æ‡≥à‡≤ï‡≥ç ‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø ‡≤®‡≤ø‡≤∞‡≤æ‡≤ï‡≤∞‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü');
                    } else {
                        showMessage(`‡≤Æ‡≥à‡≤ï‡≥ç‡≤∞‡≥ä‡≤´‡≥ã‡≤®‡≥ç ‡≤¶‡≥ã‡≤∑: ${err.name}`, 'error');
                        updateValidationUI('default', `‡≤Æ‡≥à‡≤ï‡≥ç ‡≤¶‡≥ã‡≤∑: ${err.name}`);
                    }
                    stopRecordingVisuals();
                });
        }

        async function checkMicPermissionAndStart() {
            if (typeof navigator.permissions?.query !== 'function') {
                 console.warn("Permissions API not supported. Falling back to getUserMedia directly.");
                 requestMicPermissionAndStart();
                 return;
             }
             try {
                 const permissionStatus = await navigator.permissions.query({ name: 'microphone' });
                 micPermissionState = permissionStatus.state;
                 console.log(`Current microphone permission state: ${micPermissionState}`);
                 if (micPermissionState === 'granted') {
                     startRecognitionEngine();
                 } else if (micPermissionState === 'prompt') {
                     requestMicPermissionAndStart();
                 } else {
                     showMessage("‡≤Æ‡≥à‡≤ï‡≥ç‡≤∞‡≥ä‡≤´‡≥ã‡≤®‡≥ç ‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø ‡≤®‡≤ø‡≤∞‡≤æ‡≤ï‡≤∞‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü. ‡≤¨‡≥ç‡≤∞‡≥å‡≤∏‡≤∞‡≥ç ‡≤∏‡≥Ü‡≤ü‡≥ç‡≤ü‡≤ø‡≤Ç‡≤ó‡≥ç‡≤∏‡≥ç ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤ø‡≤∏‡≤ø.", 'error');
                     updateValidationUI('default', '‡≤Æ‡≥à‡≤ï‡≥ç ‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø ‡≤®‡≤ø‡≤∞‡≤æ‡≤ï‡≤∞‡≤ø‡≤∏‡≤≤‡≤æ‡≤ó‡≤ø‡≤¶‡≥Ü');
                 }
                 permissionStatus.onchange = () => {
                     console.log(`Mic permission state changed to: ${permissionStatus.state}`);
                     micPermissionState = permissionStatus.state;
                 };
             } catch (err) {
                 console.error("Error querying microphone permissions:", err);
                 showMessage("‡≤Ö‡≤®‡≥Å‡≤Æ‡≤§‡≤ø ‡≤∏‡≥ç‡≤•‡≤ø‡≤§‡≤ø ‡≤™‡≤∞‡≤ø‡≤∂‡≥Ä‡≤≤‡≤ø‡≤∏‡≤≤‡≥Å ‡≤∏‡≤æ‡≤ß‡≥ç‡≤Ø‡≤µ‡≤æ‡≤ó‡≤≤‡≤ø‡≤≤‡≥ç‡≤≤.", 'error');
                 requestMicPermissionAndStart();
             }
        }

         function stopRecording() {
            if (recognition && isRecording) {
                 try { recognition.stop(); } catch (e) { console.warn("Error stopping recognition:", e); }
            }
            stopRecordingVisuals();
        }

        function stopRecordingVisuals() {
             isRecording = false;
             recordButton.classList.remove('recording');
             recordButton.innerHTML = `<i class="fas fa-microphone"></i> ‡≤π‡≥á‡≤≥‡≤ø`;
              const currentStatus = recognizedTextElement.className;
              // Only reset UI if it was stuck in a transient state
              if (currentStatus.includes('validation-listening') || currentStatus.includes('fa-spinner')) {
                  resetValidationUI();
              }
        }

        // --- Event Listeners Setup ---
        prevButton.addEventListener('click', () => {
            if (currentContentIndex > 0) {
                currentContentIndex--;
                if (synth.speaking) synth.cancel();
                if (isRecording) stopRecording();
                updateDisplay();
            }
        });

        nextButton.addEventListener('click', () => {
            if (!nextButton.disabled) {
                if (currentContentIndex < courseContent.length - 1) {
                    currentContentIndex++;
                    if (synth.speaking) synth.cancel();
                    if (isRecording) stopRecording();
                    updateDisplay();
                } else {
                    showMessage("‡≤Ö‡≤≠‡≤ø‡≤®‡≤Ç‡≤¶‡≤®‡≥Ü‡≤ó‡≤≥‡≥Å! ‡≤®‡≥Ä‡≤µ‡≥Å ‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤™‡≤æ‡≤†‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤™‡≥Ç‡≤∞‡≥ç‡≤£‡≤ó‡≥ä‡≤≥‡≤ø‡≤∏‡≤ø‡≤¶‡≥ç‡≤¶‡≥Ä‡≤∞‡≤ø!", 'info');
                    displayArea.textContent = "üéâ";
                    progressBar.style.backgroundColor = '#48bb78';
                }
            }
        });

        speakButton.addEventListener('click', () => {
            if (isRecording) stopRecording();
            const textToSpeak = courseContent[currentContentIndex]?.text;
            if (textToSpeak) {
                if (!currentItemHintUsed) {
                    hintCounter++;
                    hintCountSpan.textContent = hintCounter;
                    const currentLessonTitle = courseContent[currentContentIndex].lessonTitle;
                    if(lessonScores[currentLessonTitle]) {
                        lessonScores[currentLessonTitle].hints++;
                    }
                    currentItemHintUsed = true;
                }
                speakText(textToSpeak);
            }
        });

         recordButton.addEventListener('click', () => {
            if (isRecording) {
                stopRecording();
            } else {
                resetValidationUI(); // Reset feedback before starting
                if (synth.speaking) { synth.cancel(); }
                checkMicPermissionAndStart();
            }
        });

        // --- Application Initialization ---
        function initializeApp() {
             console.log("Initializing Kannada Learning Helper...");
             prepareCourseContent();
             if (courseContent.length === 0) {
                 showMessage("‡≤Ø‡≤æ‡≤µ‡≥Å‡≤¶‡≥á ‡≤™‡≤æ‡≤†‡≤¶ ‡≤µ‡≤ø‡≤∑‡≤Ø ‡≤ï‡≤Ç‡≤°‡≥Å‡≤¨‡≤Ç‡≤¶‡≤ø‡≤≤‡≥ç‡≤≤!", 'error');
                 [prevButton, nextButton, speakButton, recordButton].forEach(btn => btn.disabled = true);
                 return;
             }
             if(initializeSpeechRecognition()) {
                 updateDisplay();
                 console.log("Application initialized successfully.");
             } else {
                 console.error("Speech recognition could not be initialized.");
             }
        }

        // Wait for voices to load before initializing
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = initializeApp;
             if (speechSynthesis.getVoices().length > 0) {
                 console.log("Voices already available.");
                 setTimeout(initializeApp, 50);
             } else {
                  console.log("Waiting for voiceschanged event...");
             }
        } else {
             console.warn("onvoiceschanged not supported. Using timeout.");
             setTimeout(initializeApp, 500);
        }

    </script>

</body>
</html>
